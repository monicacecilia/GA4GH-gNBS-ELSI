<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GA4GH gNBS ELSI Policy Navigator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jsPDF CDN for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for accordion and tabs */
        .tab-button.active {
            border-bottom-color: #3b82f6; /* blue-500 */
            color: #3b82f6;
        }
        .category-button.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .accordion-content.open {
            /* Increased max-height to accommodate longer text */
            max-height: 2000px; 
        }
        /* Confirmation Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .modal-box {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 90%;
            max-width: 400px;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .modal-overlay.visible .modal-box {
            transform: scale(1);
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-6 py-4">
            <h1 class="text-3xl font-bold text-blue-600">GA4GH gNBS ELSI Policy Navigator</h1>
            <p class="mt-1 text-gray-600">A tool for implementers of genomic sequencing for newborn screening to navigate ethical, legal, and social issues. Created by the Regulatory and Ethics Work Stream (REWS) of the Global Alliance for Genomics and Health (GA4GH).</p>
        </div>
    </header>

    <!-- Tab Navigation -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="container mx-auto px-6 flex">
            <button class="tab-button text-gray-500 font-semibold py-4 px-6 border-b-2 border-transparent transition active" data-target="introduction">Introduction</button>
            <button class="tab-button text-gray-500 font-semibold py-4 px-6 border-b-2 border-transparent transition" data-target="strategic-questions">Strategic Questions</button>
            <button class="tab-button text-gray-500 font-semibold py-4 px-6 border-b-2 border-transparent transition" data-target="decision-points">Decision Points Navigator</button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto p-6">

        <!-- 1. Introduction Tab -->
        <section id="introduction" class="tab-content bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">Welcome to the ELSI Navigator</h2>
            
            <div class="space-y-6">
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-blue-600">The Why</h3>
                    <p class="text-gray-700 leading-relaxed">
                        Newborn screening (NBS) programs are a public health program designed to identify newborns who would benefit from pre-symptomatic treatment. Many research projects and pilot studies around the world are currently assessing the integration of genomic sequencing into NBS programs (gNBS).
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-4">
                        Any entity seeking to implement gNBS – as research projects, pilot programs, or full implementation — needs to engage with a wide variety of ethical, legal, and social implications (ELSI) in order to successfully deliver benefits to screened newborns and their families whilst also mitigating possible harms. Indeed, successful navigation of ELSI is vital to building public trust in gNBS and also to maintaining existing public trust in newborn screening.
                    </p>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-2 text-blue-600">The What</h3>
                    <p class="text-gray-700 leading-relaxed">
                        This tool sets out the decision points with significant ELSI components relevant to gNBS implementers. “Implementers” include those who are designing and implementing research projects, pilot studies, or actual deployment.
                    </p>
                    <p class="text-gray-700 leading-relaxed mt-4">
                        The tool serves two purposes. First, to help implementers identify, assess, and address ELSI, and second, to provide a framework by which implementers can capture key choices made and their rationale, in a format that facilitates comparison, learning and common evaluative metrics between programs.
                    </p>
                </div>
                <!-- ADDED CONTACT INFO HERE -->
                <div class="pt-4 border-t border-gray-200">
                    <p class="text-gray-600 italic">
                        Please email <a href="mailto:rews-coordinator@ga4gh.org" class="text-blue-600 hover:underline">rews-coordinator@ga4gh.org</a> with any feedback or questions. In particular, if you are willing to share your notes or approach, please email them your downloaded file.
                    </p>
                </div>
            </div>
        </section>

        <!-- 2. Strategic Questions Tab -->
        <section id="strategic-questions" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Strategic Questions to Guide Decision Making</h2>
            <p class="mb-6 text-gray-600">Implementers should first address the following key questions about project alignment with future deployment of gNBS, as these insights help guide subsequent decision-making.</p>
            <div id="strategic-questions-container" class="space-y-4">
                <!-- Strategic questions will be injected here by JS -->
            </div>
        </section>

        <!-- 3. Decision Points Tab -->
        <section id="decision-points" class="tab-content hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Navigating Decision Points</h2>
            
            <!-- EXPORT CONTROLS -->
            <div class="bg-white p-4 rounded-lg shadow-md mb-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">Export & Data Management</h3>
                <p class="text-sm text-gray-600 mb-4">Save your notes as a TSV/PDF, or clear all notes from your browser.</p>
                <div class="flex flex-wrap gap-4">
                    <button id="export-tsv" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition">
                        Export Notes to TSV
                    </button>
                    <button id="export-pdf" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition">
                        Export Report to PDF
                    </button>
                    <button id="clear-notes" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition">
                        Clear All Notes
                    </button>
                </div>
            </div>

            <div class="flex flex-col md:flex-row gap-6">
                <!-- Left: Category Navigation -->
                <aside class="md:w-1/4">
                    <div class="sticky top-24">
                        <h3 class="text-lg font-semibold mb-3 text-gray-700">Categories</h3>
                        <nav id="category-list" class="flex flex-col space-y-2">
                            <!-- Category buttons will be injected here by JS -->
                        </nav>
                    </div>
                </aside>
                <!-- Right: Decision Points Content -->
                <!-- UPDATED CONTAINER TO REFLECT ACCORDION STRUCTURE -->
                <div id="decision-points-container" class="md:w-3/4 space-y-4">
                    <!-- Decision points will be injected here by JS -->
                </div>
            </div>
        </section>

    </main>

    <!-- Confirmation Modal -->
    <div id="clear-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="text-xl font-bold text-gray-800 mb-4">Are you sure?</h3>
            <p class="text-gray-600 mb-6">This will permanently delete all your saved notes from this browser. This action cannot be undone.</p>
            <div class="flex justify-end gap-4">
                <button id="cancel-clear" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition">
                    Cancel
                </button>
                <button id="confirm-clear" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition">
                    Yes, Clear All Notes
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // --- DATA FROM THE GOOGLE DOCUMENT ---

        // UPDATED with full text
        const strategicQuestions = [
            {
                question: "What is the overall vision for how potential implementation of gNBS will integrate with conventional NBS?",
                considerations: "There are several different possible visions, which are often not distinguished in the literature. One vision, for example, is to deploy sequencing like any other testing technology, utilizing parameters as similar as possible to existing NBS programs (no changes to consent or data storage, and no re-interrogation of data later in life planned). Another vision is to offer gNBS as an optional additional test—separately consented—within conventional NBS. Other visions are possible, and what is feasible will depend on many jurisdiction-specific considerations, including regulatory requirements, the nature of the health system, and current NBS practices."
            },
            {
                question: "What consent process, if any, is envisioned for any potential deployment of gNBS, and how does this relate to how conventional NBS is implemented?",
                considerations: "The answer to this question may be constrained by regulatory and other requirements, and should be informed by existing evidence and recommendations, and likely by stakeholder engagement:<br><br>If conventional NBS involves explicit consent, and gNBS:<br>Would be offered combined with conventional NBS, with one consent process: Need to assess whether integration of sequencing would cause some parents to refuse all NBS; Need to decide whether integration of sequencing should lead to more parental engagement<br>Would be separately offered, with its own consent: Need to decide what level of parental engagement would be required; Need to assess resource requirements for this; Need to assess whether this offer would decrease likelihood of consent for conventional NBS. Evidence in Canada suggests that public participation may decrease with gNBS compared to conventional NBS.<br>Not yet clear if gNBS would be offered combined with conventional NBS (with one consent) or separate with its own consent: Consider testing different options as part of the implementation study design<br><br>If conventional NBS does not involve explicit consent, and gNBS:<br>Would be offered combined, also with no explicit consent: Ensure that the sequencing offering mirrors, as closely as possible, the parameters of conventional NBS for criteria for conditions included and for data storage and retention; Assess whether this strategy would lessen participation in conventional NBS<br>Would be separately offered, with explicit consent: Need to assess when and how consent is asked for, with an intent to ensure meaningful parental engagement in decision making.<br>Not yet clear if this would involve explicit consent: Need to gather data on stakeholder perspectives as part of pilot; Consider testing different options as part of implementation study design"
            },
            {
                question: "How will the use of genomic data be different from the use of conventional NBS data?",
                considerations: "Residual dried blood spots and the data generated during conventional NBS are stored and reused for retesting, quality assurance, and test development. Jurisdictions differ on the length of the retention and storage periods, what secondary uses of the data (such as for research) are permitted, and who can access the data. Genomic data has the potential to be interrogated more than conventional NBS data, as the data are much more extensive. The issue of identifiability becomes more pressing with genomic data. The question of data reuse is tied to the question of consent for NBS, for example evidence from parents and screening professionals in the UK suggests views on gaining consent for NBS differ depending on whether blood spots are stored, whereas public views in Canada on use depend on the particular secondary uses."
            },
            {
                question: "Will there be the opportunity to screen/re-test the same children again in the future?",
                considerations: "In some jurisdictions, typically those with publicly-funded healthcare systems, a longitudinal relationship with participants/patients is possible. In others, this would be the exception. This is relevant because some of the conditions that could be screened for in gNBS do not become actionable until later in childhood or in adulthood. An alternative to waiting until symptoms emerge for these conditions would be to re-interrogate the data as the child ages, or, to re-sample and re-sequence at a later time point."
            },
            {
                question: "If the implementation effort is a research project or pilot study, what evidence does it need to generate in order to inform deployment decisions?",
                considerations: "Integrating gNBS has the potential to identify many more children who may benefit from early intervention. Children have the right to the highest attainable standard of health and benefit from advances in science, but this must be traded-off with the capacity and sustainability of delivering on this information at population scale in complex health system settings. It must also be compared to the alternative of the same children being identified and offered sequencing if they become symptomatic. A right to benefit from science must also be balanced against other rights, such as the children' s rights not to be subject to undue harm through, for example, unnecessary surveillance or interventions that do not change their disease course. Pilot studies lay the groundwork for a successful and scalable program through assessing feasibility and understanding the mechanics of implementation on a small scale. Research projects provide the evidence and justification for whether and how a program should be implemented. The success of either turns on whether it generates data that support wider deployment. Establishing clarity on exactly which data are needed to inform deployment will in turn inform the approach to ELSI."
            },
            {
                question: "Who does data need to be shared with to maximize the positive impact on future children screened?",
                considerations: "Because gNBS will identify children with very rare diseases, the ability to share data — and particularly clinical outcome data — across projects and jurisdictions will accelerate the field and potential health benefits. This can be enabled by upfront consideration of how best to do this within regulatory and other constraints."
            }
        ];

        // UPDATED with full text for all 59 summaries
        const decisionPointsData = [
            {
                category: "A. Stakeholder Engagement",
                id: "stakeholder",
                points: [
                    { id: "A1", decision_point: "1. How should the perspectives and preferences of families, both with and without children with rare genetic conditions, and from varied backgrounds, be included in program design?", summary: "Implementation of genomic newborn screening programs requires meaningful engagement with a range of diverse families and stakeholders to ensure programs are culturally appropriate, equitable, and meet community needs. Current evidence indicates significant limitations in representation of diverse populations in research, program design, and implementation. This suggests a need for more inclusive approaches like community review boards and consultations that actively incorporate perspectives from varied racial, ethnic, socioeconomic, and cultural backgrounds, including both families with and without experiences of rare genetic conditions." },
                    { id: "A2", decision_point: "2. How should the voice of the child be incorporated in program design?", summary: "The literature extensively discusses the ethical tension between parental proxy decision-making and preserving the child's future autonomy in genomic newborn screening (gNBS). A key challenge is balancing the potential benefits of early detection and intervention against the child's right to an open future and their ability to make informed decisions about their genetic information when they reach maturity." },
                    { id: "A3", decision_point: "3. How should the perspectives of the general public be included in program design?", summary: "Public engagement in gNBS program design is crucial for maintaining trust, ensuring acceptability, and achieving high participation rates. Evidence suggests that public perspectives can evolve through deliberative processes and vary by context. Implementers should refer to existing evidence and recommendations, and consider using multiple engagement approaches (like public dialogues, citizens’ juries, focus groups, and surveys) while ensuring representation from diverse stakeholder groups, including parents, minority communities, and healthcare providers." },
                    { id: "A4", decision_point: "4. How should healthcare providers be included in design to ensure implementation feasibility?", summary: "Healthcare provider involvement in gNBS design is crucial for successful implementation, with evidence indicating that providers have more cautious attitudes than the public and face significant challenges around workforce capacity, knowledge gaps, and workflow integration. Implementers must carefully consider both technical aspects (like system integration and workflow automation) and social aspects (like provider education and engagement strategies), while ensuring representation from diverse provider types including primary care, managing specialists, and genetics professionals." },
                    { id: "A5", decision_point: "5. How should policy-makers be included in design to help assess feasibility and optimize implementation?", summary: "Policy-maker involvement in genomic newborn screening (gNBS) design is essential for addressing systemic barriers, ensuring adequate infrastructure, and aligning programs with health system priorities and regulatory frameworks. Implementers must engage policy-makers early in design to address governance gaps, resource constraints, cross-jurisdictional coordination challenges, and health equity concerns, while balancing standardization with local adaptation and innovation with evidence requirements." },
                    { id: "A6", decision_point: "6. Should commercial/industry partners be involved in program design, and if so, how should conflicts be managed?", summary: "Commercial involvement in genomic newborn screening presents both opportunities (accelerating therapeutic development, addressing funding gaps) and significant risks (equity concerns, conflicts of interest, data privacy, technology-led rather than needs-led implementation, screening decisions driven by commercial imperatives). The literature emphasizes the need for careful oversight and governance structures, as well as the importance of transparency, to manage commercial partnerships while maintaining public health priorities and protecting against the creation of two-tier systems based on knowledge and ability to pay." }
                ]
            },
            {
                category: "B. Consent Models",
                id: "consent",
                points: [
                    { id: "B7", decision_point: "7. If the study is a research project, will there be a separate research and clinical consent?", summary: "The literature suggests significant tension between research and clinical care paradigms in genomic newborn screening, with different consent requirements traditionally applied to each domain. Key considerations include whether combining research and clinical consent could reduce participation rates and burden on parents, versus whether separate consent processes are needed to ensure clarity about different uses of genomic data and maintain public trust." },
                    { id: "B8", decision_point: "8. When will consent be obtained?", summary: "The timing of consent for genomic newborn screening (gNBS) presents a critical tension between obtaining truly informed parental decisions and maintaining program feasibility. Key considerations include balancing the emotional and practical challenges of the immediate postpartum period against the need for timely sample collection, with most literature suggesting that prenatal engagement about gNBS, with confirmation of consent after birth, may be optimal." },
                    { id: "B9", decision_point: "9. If conventional NBS uses a model of explicit consent, what are the considerations for making gNBS a separate versus combined consent?", summary: "The literature suggests that implementing genomic newborn screening (gNBS) may require a different consent model than conventional NBS, with many authors advocating for separate and more explicit consent processes for genomic testing and long-term storage of genomic data. The key considerations – beyond legal requirements — include balancing the need for robust informed consent for generating and storing genomic information against maintaining program feasibility, with some authors proposing hybrid or tiered approaches that maintain current consent practices for traditional NBS while requiring explicit consent for additional genomic testing or screening. The literature focuses mostly on consent practices within research settings, so more research is needed for public health settings." },
                    { id: "B10", decision_point: "10. If conventional NBS is not explicitly consented, what are the considerations for making gNBS explicitly consented versus not?", summary: "The literature reveals a fundamental tension between traditional newborn screening's opt-out approach (widely adopted, with the justification of clear and immediate benefit to the child) and arguments that genomic sequencing requires explicit informed consent due to its broader implications and uncertain benefits. Implementers must carefully weigh the justifications for implied consent against respecting parental autonomy through explicit consent, while considering that genomic information has different implications than traditional screening, including potential storage of data not relevant to screened for conditions." },
                    { id: "B11", decision_point: "11. What constitutes appropriate parent information resources for gNBS?", summary: "The literature extensively discusses the need for engagement materials that balance the need for clear, informative and accessible information and decision aids, while avoiding information overload. Key considerations include the legal minimum requirements for informed consent, timing of information delivery (preferably during pregnancy), multiple formats and channels of delivery, accommodation of varying health literacy levels, and cultural sensitivity, with particular attention needed for complex genomic concepts and managing parental expectations about results." },
                    { id: "B12", decision_point: "12. Will consent be obtained for secondary uses of the data, and if so, how should this be obtained?", summary: "The literature shows widespread agreement from parents and healthcare providers (supported by law in many jurisdictions) that explicit consent should be obtained for potential secondary uses of genomic data and dried bloodspots, including research, though there is debate about the feasibility of truly informed consent given the complexity and future uncertainty of potential uses. Key considerations include balancing research benefits with privacy protections, cost, maintaining public trust, respecting parental autonomy while preserving valuable research resources, and developing consent processes that are both meaningful and practical." },
                    { id: "B13", decision_point: "13. How will withdrawals be handled, particularly for screen positive findings where there might be a duty of clinical care?", summary: "The handling of withdrawals from genomic newborn screening, particularly for screen positive findings where there might be a duty of clinical care, requires careful consideration of the tension between respecting parental autonomy and ensuring appropriate clinical care. Empirical evidence suggests that parents frequently change their minds about genomic information choices after initial consent, highlighting the need for flexible consent processes with integrated check-ins that can accommodate such changes while maintaining clinical obligations." }
                ]
            },
            {
                category: "C. Which Conditions to Include",
                id: "conditions",
                points: [
                    { id: "C14", decision_point: "14. What process (including who) is used to decide and update the condition list?", summary: "Deciding which conditions to include in genomic newborn screening requires balancing multiple stakeholder perspectives while maintaining transparent, evidence-based processes that prioritize the goals of screening. Programs must establish clear criteria for condition selection that considers factors like clinical actionability, age of onset, penetrance, and treatment availability, whilst also having mechanisms to regularly update these lists as evidence and technologies evolve — they can rely on existing frameworks to guide this process. Key considerations include establishing clear criteria for clinical validity and utility, developing mechanisms for regular review and updates as evidence evolves, and ensuring appropriate representation from medical experts, public health officials, and affected communities." },
                    { id: "C15", decision_point: "15. How should advocacy influence be balanced with evidence-based decision making when it comes to condition selection?", summary: "Patient advocacy has historically been a powerful force in expanding newborn screening programs, but there is ongoing tension between advocacy-driven expansion and evidence-based decision making. Implementers must balance the valuable perspectives and lived experiences that advocacy groups bring while ensuring that screening decisions remain grounded in scientific evidence of clinical benefit and careful consideration of potential program impacts." },
                    { id: "C16", decision_point: "16. How are \"actionability\" and clinical utility defined for condition selection (including considerations of availability and accessibility)?", summary: "Defining actionability and clinical utility for genomic newborn screening is a complex challenge that requires balancing traditional screening criteria focused on immediate medical treatment benefits against broader conceptions of benefit that include factors like avoiding diagnostic odyssey, enabling family planning, and accessing early interventions. Implementers must carefully consider whether to maintain strict requirements for proven effective, available (which will vary by jurisdiction) treatments or adopt more flexible frameworks that recognize various forms of clinical and personal utility, while ensuring that selected conditions have sufficient evidence to justify population-level screening." },
                    { id: "C17", decision_point: "17. Should conditions with variable onset, penetrance, expressivity, or pleiotropy be included?", summary: "The inclusion of conditions with variable onset, penetrance, expressivity, or pleiotropy in gNBS represents one of the most extensively debated ethical issues in the literature, with concerns centering on the balance between identifying actionable conditions early versus potential increased uncertainty creating \"patients-in-waiting\" and unnecessary anxiety. Key considerations include the psychological impact on families, healthcare resource allocation, and whether the benefits of early identification outweigh potential harms of uncertain prognoses at population or group level, with most current programs favoring a conservative approach that prioritizes conditions with high penetrance and clear childhood onset." },
                    { id: "C18", decision_point: "18. Should there be an age-of-actionability cut-off, and, if so, what should this be?", summary: "The literature reflects significant debate about whether and when to disclose genetic information about conditions that manifest or require intervention at different life stages, with particular tension around adult-onset conditions. While traditional professional guidelines have recommended against testing children for adult-onset conditions for reasons including to preserve a child’s future autonomy, emerging arguments suggest potential benefits of early identification for both the child and family members, leading some programs to adopt approaches including parental choice models and age-based disclosure frameworks." },
                    { id: "C19", decision_point: "19. Should carrier status for recessive conditions be reported?", summary: "The reporting of carrier status in genomic newborn screening represents a complex balance between potential reproductive planning benefits for families and concerns about psychological harms, child autonomy, discrimination, and healthcare system burden. Key considerations include the very high prevalence of carrier variants, challenges in providing adequate genetic counseling at scale, and varying international approaches ranging from routine disclosure to opt-in models." },
                    { id: "C20", decision_point: "20. Should there be any parental choice in categories of results returned?", summary: "The literature reveals significant debate around whether and how much choice parents should have in selecting which categories of genomic results they receive about their newborns, with considerations spanning clinical utility, future autonomy, psychological impact, practical implementation challenges (including cost). While there is broad agreement that parents should ideally have some degree of choice, there are differing views on the optimal approach - from highly granular choice to more structured \"menu\" options - with evidence suggesting parents generally want broad access to information but may benefit from guided decision-making frameworks." },
                    { id: "C21", decision_point: "21. Should major pharmacogenetics variants be included?", summary: "The inclusion of pharmacogenetic variants in gNBS offers significant potential to prevent adverse drug reactions and optimize medication dosing throughout life, but raises complex questions about clinical actionability in the newborn period, variant interpretation across diverse populations, and appropriate timing of disclosure. While there is strong theoretical support for including well-validated pharmacogenetic variants, the literature reveals a notable gap between conceptual benefits and practical implementation, with no documented real-world newborn screening programs systematically including pharmacogenetic variants at the time of these publications." }
                ]
            },
            {
                category: "D. Testing & Lab Processes",
                id: "testing",
                points: [
                    { id: "D22", decision_point: "22. Should whole genome, whole exome, targeted panel sequencing or genotyping be adopted?", summary: "The choice between whole genome sequencing (GS), whole exome sequencing (ES), or targeted gene panels represents a critical cost, technical and ethical trade-off between comprehensive detection capabilities and practical implementation challenges. While GS/ES may offer greater flexibility and future-proofing, targeted approaches may currently be more practical and cost-effective, with many gNBS research programs adopting hybrid or tiered approaches that combine targeted panels with more comprehensive sequencing in specific cases, though the evidence base is changing rapidly." },
                    { id: "D23", decision_point: "23. What sample collection methodology should be used?", summary: "The choice of sample collection methodology for genomic newborn screening involves balancing technical feasibility (DNA quantity/quality) with practical and ethical considerations like minimizing infant discomfort and integrating with existing screening infrastructure. The literature strongly supports using dried blood spots (DBS) as they leverage existing collection procedures, provide sufficient DNA quality for sequencing, can be stored long-term, and minimize additional procedures for infants, though some programs are also exploring alternatives like cord blood or saliva samples for specific applications." },
                    { id: "D24", decision_point: "24. How and when should test limitations be communicated?", summary: "The literature emphasizes that test limitations must be clearly communicated to both healthcare providers and families due to significant technical and interpretive challenges in genomic sequencing, including limitations in detecting certain variant types, variable sensitivity across conditions, and challenges with interpretation. The timing and method of communication needs to balance providing large amounts of information against overwhelming parents during the sensitive peripartum period, while ensuring limitations are understood before testing to enable informed decision-making." },
                    { id: "D25", decision_point: "25. Should variants of uncertain significance ever be reported?", summary: "The reporting of variants of uncertain significance (VUS) in genomic newborn screening presents a critical tension between comprehensive detection of potentially clinically significant variants and returning information that does not fit a screening paradigm. Implementers must weigh the benefits of increased sensitivity from reporting VUS against the risks of false positives, psychological impacts on families, and healthcare system capacity for (potentially unnecessary) follow-up, while considering technical limitations in variant interpretation particularly for diverse populations." },
                    { id: "D26", decision_point: "26. How should the challenges of variant interpretation across diverse populations be addressed?", summary: "Genomic variant interpretation faces significant challenges due to the lack of diversity in reference databases, which primarily contain data from individuals of European ancestry. This creates potential for missed diagnoses, false positive results, and/or misclassification of variants in underrepresented populations, raising serious equity concerns that implementers must address. Newborn screening programs must balance the need for accurate variant interpretation across all populations against current technical limitations while working to expand representation in genomic databases." }
                ]
            },
            {
                category: "E. Results Disclosure",
                id: "disclosure",
                points: [
                    { id: "E27", decision_point: "27. How should the process for disclosure of provisional results be managed?", summary: "The disclosure of provisional results in genomic newborn screening (gNBS) requires carefully balancing the potential benefits of early detection against the risks of causing unnecessary anxiety and harm through false positives or uncertain findings. Programs must develop clear protocols and policies that address the timing, method, and content of result disclosure while ensuring appropriate support systems are in place for families receiving results and follow up care." },
                    { id: "E28", decision_point: "28. For positive results, who should deliver results?", summary: "The literature strongly suggests that result delivery should be tailored to the type of result and condition, with genetic counselors and clinical specialists generally preferred for complex genetic findings while maintaining involvement of primary care providers who have existing relationships with families. Key considerations include the limited availability of genetic specialists, the value of established provider-family relationships, and the need for providers to have sufficient genomic knowledge to effectively communicate results." },
                    { id: "E29", decision_point: "29. For positive results, how should return be done (including what information should be provided, whether virtual or in person)?", summary: "The return of positive results from genomic newborn screening requires careful consideration of both the mode of delivery (in-person vs remote) and the content/format of information provided. Implementation decisions must balance parents' strong preference for in-person result disclosure by genetic specialists against practical feasibility constraints in large-scale screening programs, while ensuring appropriate psychological support and follow-up care." },
                    { id: "E30", decision_point: "30. For positive results, how can the psychological impacts on families be assessed, addressed and minimised, and with what role for advocacy and patient community input?", summary: "Psychological impacts of positive gNBS results on families represent a major concern requiring careful management, with evidence indicating risks of anxiety, depression, parent-child bonding disruption, and relationship strain, particularly for uncertain or untreatable conditions. However, studies also show that with appropriate support systems including genetic counseling, clear result communication, and access to specialist care and peer support groups, these negative impacts can be minimized while preserving the benefits of early detection; consumer involvement in program design would help to this end." },
                    { id: "E31", decision_point: "31. For negative results, will results be returned, and if so, using what model?", summary: "The literature shows varying approaches to returning negative results in gNBS, with some programs actively communicating these results while others only provide them upon request. Key considerations include balancing psychological benefits (such as providing peace of mind to parents) against healthcare system resource constraints, while also ensuring effective documentation and communication methods." },
                    { id: "E32", decision_point: "32. How to build sufficient genomics expertise in the healthcare provider workforce, particularly pregnancy providers and pediatricians?", summary: "Healthcare providers often lack sufficient knowledge and confidence to effectively discuss and action genomic newborn screening results, with studies showing widespread discomfort in interpreting and communicating genomic results. A multi-faceted approach combining professional education, supportive infrastructure, and potentially new service delivery models is needed to build adequate workforce capacity, as the current genetics workforce is insufficient to handle population-wide genomic screening." },
                    { id: "E33", decision_point: "33. What should be done if a newborn dies before or soon after result return (including what should happen to their data)?", summary: "There is very little literature on this topic. When a newborn dies before or soon after result return, programs need to consider both the immediate handling of genetic/metabolic data for any post-mortem analysis (if applicable) and the broader implications for family members who might benefit from this information." }
                ]
            },
            {
                category: "F. Post-test Management",
                id: "post-test",
                points: [
                    { id: "F34", decision_point: "34. What standards should be established for clinical follow-up after screening (including resources provided for healthcare providers, and the role of advocacy groups)?", summary: "Implementing genomic newborn screening requires establishing comprehensive standards for clinical follow-up that address both immediate and long-term care needs, including genetic counseling, specialist referrals, and ongoing monitoring. The literature emphasizes that follow-up systems must integrate multiple stakeholders (healthcare providers, genetic specialists, advocacy groups) while ensuring equitable access to necessary treatments and support services, with particular attention to preventing healthcare disparities and maintaining adequate workforce capacity." },
                    { id: "F35", decision_point: "35. How should referral networks and other follow-up care infrastructure be developed to support families after positive genomic findings?", summary: "Healthcare systems currently lack sufficient infrastructure and workforce capacity to handle the increased demands that would come from genomic newborn screening, particularly for coordinating follow-up care across multiple specialists and providing genetic counseling services. The literature emphasizes that comprehensive support systems that integrate specialized expertise are needed, as are multidisciplinary care teams, and mechanisms to ensure equitable access to follow-up services, especially for geographically dispersed and underserved populations." },
                    { id: "F36", decision_point: "36. Should the program plan for surveillance and follow up of positive findings, including those with later-onset conditions?", summary: "The literature extensively discusses the need for long-term follow-up of positive findings from genomic newborn screening, particularly for later-onset conditions, with broad agreement that comprehensive follow-up systems are essential but challenging to implement. Key considerations include the resource implications of lifelong surveillance, the need for standardized protocols, data collection for understanding natural disease progression, and ensuring equitable access to follow-up care across healthcare systems." },
                    { id: "F37", decision_point: "37. To what extent should the program coordinate cascade testing, and if so to what degree relatives?", summary: "Cascade testing following genomic newborn screening raises complex ethical tensions between potential benefits to family members and issues of privacy, autonomy (e.g. right not to know), and healthcare access barriers. Programs must carefully balance the opportunity to identify and prevent serious conditions in relatives against challenges including consent processes, healthcare system fragmentation, and equitable access to follow-up testing and care." },
                    { id: "F38", decision_point: "38. How should healthcare system disparities that affect follow-up care be addressed?", summary: "Health equity gaps in follow-up care represent a critical challenge for genomic newborn screening (gNBS) implementation, with concerns that without careful planning, gNBS could exacerbate existing inequities in healthcare access and outcomes. Key considerations include ensuring adequate infrastructure and resources for follow-up care, addressing financial barriers to access treatments and services, developing support systems for underserved populations, and creating mechanisms to ensure equitable access to genetic expertise and specialized care across different geographic and socioeconomic contexts, especially for communities with pre-existing healthcare disparities." },
                    { id: "F39", decision_point: "39. What aggregate outcomes data should the program plan to collect?", summary: "The literature emphasizes the critical importance of collecting comprehensive outcomes data to evaluate program effectiveness, advance scientific understanding of rare diseases, and support evidence-based policy decisions. Key considerations include: the need to balance data collection for research purposes with the primary public health mandate, ensure standardization across jurisdictions, and develop adequate infrastructure for long-term follow-up while protecting privacy." }
                ]
            },
            {
                category: "G. Data Management",
                id: "data-management",
                points: [
                    { id: "G40", decision_point: "40. What data should be stored on each baby (e.g., .fastq files, .bam files, .vcf files, only data related to genes currently included in the gNBS program, only gNBS results reported back to patient’s physician or family)?", summary: "This decision presents trade-offs between maximizing future clinical utility through comprehensive data retention and managing practical constraints including storage costs, privacy risks, and data governance complexities. While storing raw sequence data (.fastq, .bam files) enables future reanalysis as knowledge advances, implementers must balance this potential against substantial infrastructure requirements and environmental impacts, consent implications for lifelong data storage, and the need for robust security measures to protect sensitive genomic information that could impact both the child and their biological relatives." },
                    { id: "G41", decision_point: "41. For how long should sequence data be maintained (legal minimum or longer)?", summary: "Long-term data storage (beyond what is legally required) is not an essential component of gNBS but may have profound implications for a project’s/program’s costs, consent protocols, risks, and public acceptance. The duration of genomic data storage from newborn screening presents a fundamental tension between potential future clinical benefits and risks to privacy and public acceptance, with considerations including costs of storage, data security, potential for reanalysis as knowledge advances (versus the possible need to re-test using new technology), the rights of the parents to withdraw from data storage rights of the child to make decisions about their data when they reach majority. Implementers must carefully weigh the trade-offs between destroying data to protect privacy versus maintaining it for future clinical use, while considering practical constraints like storage costs, feasibility in a screening paradigm, technological evolution, and regulatory requirements." },
                    { id: "G42", decision_point: "42. Who will store the data and where will it be stored?", summary: "The storage of genomic data from newborn screening raises significant technical, ethical, and legal challenges around data security, privacy protection, and long-term accessibility. Implementers must balance the clinical and research utility of maintaining genomic data—and making it accessible when and where needed—against privacy risks, storage costs, and infrastructure requirements, while ensuring appropriate governance frameworks for data access, management, and interoperability." },
                    { id: "G43", decision_point: "43. What security and privacy measures should be implemented to protect genomic data?", summary: "Implementing genomic newborn screening requires robust privacy and security measures to protect sensitive genetic data from unauthorized access, discrimination, and potential misuse by third parties including insurers, employers, and law enforcement. Key considerations include data storage infrastructure, access controls, encryption, consent processes for data sharing, and legal frameworks to prevent genetic discrimination, with particular attention needed for marginalized communities who may be more vulnerable to privacy breaches and discrimination." },
                    { id: "G44", decision_point: "44. How will requests to delete data be managed?", summary: "The management of data deletion requests in gNBS programs involves balancing parental rights, future autonomy of the child, and public health benefits against privacy concerns and potential misuse of genetic information. Programs must consider whether to allow parents and/or children to request data deletion, at what age control transfers from parents to children, and how to balance these requests against the potential future clinical and research utility of the data, along with regional legal requirements." },
                    { id: "G45", decision_point: "45. Should parents or the child be able to access their data (this may be legally required), and, if so, what information should be provided?", summary: "The literature highlights a fundamental tension between parents' rights to access their children's genomic data and the child's future autonomy, with additional considerations around data privacy, clinical utility, and potential discrimination. Implementers must balance providing appropriate parental access for healthcare decisions while protecting the child's future interests and right to privacy, with particular attention to consent processes, data ownership transfer mechanisms, and clear protocols for data access and protection." },
                    { id: "G46", decision_point: "46. Will there be a process of transferring data ownership from the parents to the child?", summary: "The literature extensively discusses the ethical tension between parental proxy decision-making for newborn genomic screening and preserving the child's future autonomy to make decisions about their genetic information. A key consideration for implementers is developing mechanisms to transition control of genomic data from parents to children as they mature, while ensuring appropriate data storage, privacy protections, and clear policies for accessing and managing the information throughout the individual's lifetime." },
                    { id: "G47", decision_point: "47. Who will the data be shared with, for which purposes, (e.g. data federation for purposes of directly improving the public health program), and which data will be shared?", summary: "Data sharing decisions for genomic newborn screening programs must balance the critical need for international collaboration to advance rare disease research and variant interpretation against privacy concerns, potential misuse, and discrimination risks. Implementers must carefully consider multiple stakeholder perspectives on who should have access to the data (e.g., clinicians, researchers, industry partners, law enforcement), establish robust governance frameworks for data protection, and determine appropriate consent processes for secondary uses while ensuring compliance with relevant regulations." },
                    { id: "G48", decision_point: "48. Will there be any allowed secondary use of the data (beyond purpose of screening, quality assurance, program development), and if so, what governance structures would oversee it?", summary: "Secondary use of newborn screening genomic data presents a fundamental tension between advancing scientific knowledge/improving healthcare and protecting individual privacy/autonomy. Implementers must carefully consider governance structures that balance research benefits with privacy protections, while maintaining public trust through transparency and appropriate consent mechanisms." }
                ]
            },
            {
                category: "H. Data Revisiting",
                id: "data-revisiting",
                points: [
                    { id: "H49", decision_point: "49. Should genomic data be periodically reanalyzed as knowledge that impacts variant interpretation advances (and if so, with what time limit)?", summary: "Periodic reanalysis of genomic data for symptomatic individuals is widely recognized as crucial due to the rapidly evolving nature of genetic knowledge, with studies showing significant changes in variant interpretations within just 1-2 years. However, implementers must carefully weigh the potential benefits of reanalysis against substantial resource requirements and challenges in determining responsibility for updates, storage, and recontact procedures." },
                    { id: "H50", decision_point: "50. Should genomic data be periodically reanalyzed as the gene list changes (and if so, with what time limit)?", summary: "The literature related to symptomatic individuals strongly suggests that genomic data should be periodically reanalyzed as gene lists evolve, given the rapid pace of discovery in genetic medicine and emergence of new treatments that could make conditions actionable. However, implementers must carefully consider whether this literature is relevant in the screening setting, as well as the resource implications, legal obligations, and infrastructure requirements for long-term data storage and reanalysis processes." },
                    { id: "H51", decision_point: "51. Should there be any planned disclosures of information that is relevant later in life?", summary: "The literature extensively discusses the ethical tension between providing potentially beneficial health information throughout life versus protecting the child's future autonomy and right not to know. A key consideration is whether and how to implement systems for staged disclosure of genetic information at developmentally and clinically appropriate times, balancing the benefits of early knowledge against the challenges of storing and managing genomic data long-term. A further key consideration is the extent to which information relevant later in life is ‘core business’ of NBS." },
                    { id: "H52", decision_point: "52. Should the data be available for diagnostic purposes, if the child develops a phenotype?", summary: "The literature predominantly supports making genomic data available for future diagnostic purposes, citing benefits like reduced diagnostic delays and cost-effectiveness of reanalyzing existing data versus new testing. However, this raises important considerations around data provenance, data quality, storage infrastructure, privacy protections, and consent processes that need to be carefully addressed in implementation. Additionally, implementers should also consider the ease with which (newer) genome sequencing can be done for diagnostic purposes." },
                    { id: "H53", decision_point: "53. Should the ability to recontact parents, and eventually the child, be maintained, and if so, how?", summary: "The ability to recontact parents and eventually the child is viewed as crucial for multiple purposes including research participation, variant reclassification, disclosure of adult-onset conditions, and transfer of genetic information when the child reaches maturity. The main challenges involve establishing robust systems for maintaining contact over long periods, determining responsibility for recontact, and creating clear procedures for transferring information control from parents to children." }
                ]
            },
            {
                category: "I. Evaluation & Governance",
                id: "governance",
                points: [
                    { id: "I54", decision_point: "54. How should project success be defined and measured?", summary: "The literature emphasizes that defining and measuring success in genomic newborn screening (gNBS) requires balancing multiple dimensions including clinical utility, cost-effectiveness, equity of access, and psychosocial impacts on families. Attention is also needed to the effect on competing public health priorities, the need to evaluate public participation or public buy-in, the effect on existing newborn screening programs, or access to appropriate followup. The literature emphasizes the need for comprehensive evaluation frameworks that go beyond traditional clinical outcomes to include both quantitative metrics and qualitative assessments of program impacts across stakeholder groups." },
                    { id: "I55", decision_point: "55. What governance system should be put in place for managing emerging issues?", summary: "The literature emphasizes that implementing genomic newborn screening requires comprehensive governance systems that can address multiple challenges including ethical oversight, stakeholder engagement, data sharing, quality assurance, and cross-jurisdictional coordination. A key consideration is the need to balance rapid technological advancement with careful ethical implementation while ensuring programs maintain public participation and protect their core public health mission, likely involving advisory boards and governing agencies." },
                    { id: "I56", decision_point: "56. How can transparency be assured in decision-making processes?", summary: "The literature emphasizes that transparency in decision-making processes is fundamental for maintaining public trust in genomic newborn screening programs and should encompass clear documentation of criteria for condition selection, program financing, and benefit distribution. Implementers should focus on establishing formal mechanisms for transparent documentation and communication of decisions, while ensuring meaningful engagement with multiple stakeholders including medical professionals, researchers, patient advocacy groups, and the general public." },
                    { id: "I57", decision_point: "57. What are the priorities for cross-jurisdiction policy consistency, both across regions and internationally?", summary: "The literature strongly emphasizes that significant variation exists in newborn screening programs across jurisdictions, both within countries and internationally, creating inequities in screening access and healthcare outcomes based solely on geography. A key tension exists between respecting local/state autonomy in healthcare decision-making and the need for standardization to ensure equitable access to screening, with most authors advocating for increased harmonization while acknowledging the need to account for regional differences in healthcare systems, resources, and priorities." },
                    { id: "I58", decision_point: "58. How should sustainability of any ongoing implementation be planned for, including expansion of downstream capacity?", summary: "Implementing genomic newborn screening requires careful consideration of long-term financial sustainability and system capacity for expanded screening, including costs beyond just sequencing (like interpretation, follow-up care, and data management). Programs must balance the decreasing costs of sequencing technology against the substantial infrastructure and workforce requirements needed for comprehensive screening programs, while ensuring adequate resources for both existing and expanded screening capabilities." },
                    { id: "I59", decision_point: "59. How should closing the project be managed?", summary: "Managing project closure in genomic newborn screening implementations requires careful consideration of both sustaining established screening programs and planning for future capacity. Key considerations include maintaining public trust in traditional newborn screening programs while managing the transition or expansion of genomic screening capabilities." }
                ]
            }
        ];

        // --- EXPORT FUNCTIONS ---

        function sanitizeForTSV(text) {
            if (!text) return '';
            return text.replace(/\s+/g, ' ').replace(/\t/g, ' ').trim();
        }

        function exportTSV() {
            let tsvContent = "ID\tDecision Point\tYour Note\n";
            const rows = [];

            decisionPointsData.forEach(category => {
                category.points.forEach(point => {
                    const noteKey = `note-${point.id}`;
                    const noteValue = localStorage.getItem(noteKey) || '';
                    const decisionText = sanitizeForTSV(point.decision_point);
                    const noteText = sanitizeForTSV(noteValue);
                    rows.push(`${point.id}\t${decisionText}\t${noteText}`);
                });
            });

            tsvContent += rows.join('\n');
            
            const blob = new Blob([tsvContent], { type: 'text/tab-separated-values;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            link.setAttribute("href", url);
            link.setAttribute("download", "gnbs_elsi_notes.tsv");
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function addWrappedText(doc, text, x, y, maxWidth, options = {}) {
            const { fontSize = 10, fontStyle = 'normal', color = [0, 0, 0] } = options;
            doc.setFontSize(fontSize);
            doc.setFont('helvetica', fontStyle);
            doc.setTextColor(color[0], color[1], color[2]);
            
            const lines = doc.splitTextToSize(text, maxWidth);
            let currentY = y;
            
            lines.forEach(line => {
                if (currentY > 280) { // Margin for page break
                    doc.addPage();
                    currentY = 20; // Reset Y to top margin
                }
                doc.text(line, x, currentY);
                currentY += (fontSize * 0.4); // Adjust line height
            });
            
            return currentY; // Return the new Y position
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const margin = 15;
            const maxLineWidth = doc.internal.pageSize.getWidth() - (margin * 2);
            let currentY = 20;

            // Title
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text("gNBS ELSI Navigator - Report", margin, currentY);
            currentY += 10;
            
            // Subtitle
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text(`Exported on: ${new Date().toLocaleDateString()}`, margin, currentY);
            currentY += 15;

            // Iterate over all data
            decisionPointsData.forEach(category => {
                // Check for page break before category title
                if (currentY > 260) {
                    doc.addPage();
                    currentY = 20;
                }

                // Category Title
                currentY = addWrappedText(doc, category.category, margin, currentY, maxLineWidth, {
                    fontSize: 14,
                    fontStyle: 'bold',
                    color: [67, 56, 202] // indigo-700
                });
                currentY += 5; // Padding after category title

                category.points.forEach(point => {
                    const noteKey = `note-${point.id}`;
                    const noteValue = localStorage.getItem(noteKey) || 'No notes added.';

                    // Check for page break before new point
                    if (currentY > 250) {
                        doc.addPage();
                        currentY = 20;
                    }

                    // Decision Point
                    currentY = addWrappedText(doc, point.decision_point, margin, currentY, maxLineWidth, {
                        fontSize: 11,
                        fontStyle: 'bold'
                    });
                    currentY += 2; // Padding

                    // Summary
                    currentY = addWrappedText(doc, "Summary: " + point.summary, margin + 5, currentY, maxLineWidth - 5, {
                        fontSize: 9,
                        fontStyle: 'italic',
                        color: [100, 116, 139] // slate-500
                    });
                    currentY += 3; // Padding

                    // Note
                    currentY = addWrappedText(doc, "Your Note: " + noteValue, margin + 5, currentY, maxLineWidth - 5, {
                        fontSize: 9,
                        fontStyle: 'normal'
                    });
                    currentY += 8; // Padding between decision points
                });
            });

            // Save the PDF
            doc.save('gnbs_elsi_report.pdf');
        }

        function clearAllNotes() {
            decisionPointsData.forEach(category => {
                category.points.forEach(point => {
                    const noteKey = `note-${point.id}`;
                    localStorage.removeItem(noteKey);
                });
            });
            console.log("All notes cleared from localStorage.");
        }


        // --- APPLICATION LOGIC ---

        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.tab-button');
            const contents = document.querySelectorAll('.tab-content');
            const clearModal = document.getElementById('clear-modal');
            const clearNotesBtn = document.getElementById('clear-notes');
            const cancelClearBtn = document.getElementById('cancel-clear');
            const confirmClearBtn = document.getElementById('confirm-clear');
            
            let currentCategoryId = decisionPointsData[0].id; // Keep track of active category

            // --- Tab Switching Logic ---
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Deactivate all
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.add('hidden'));

                    // Activate clicked
                    tab.classList.add('active');
                    document.getElementById(tab.dataset.target).classList.remove('hidden');
                });
            });

            // --- 1. Load Strategic Questions (Accordion) ---
            const strategicContainer = document.getElementById('strategic-questions-container');
            strategicQuestions.forEach((item, index) => {
                const element = document.createElement('div');
                element.className = 'bg-white rounded-lg shadow-md';
                // Updated innerHTML to render <br> tags correctly
                element.innerHTML = `
                    <button class="accordion-button w-full text-left p-5 font-semibold text-gray-700 flex justify-between items-center transition hover:bg-gray-50 rounded-lg">
                        <span>${index + 1}. ${item.question}</span>
                        <svg class="w-5 h-5 transition-transform transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <div class="accordion-content">
                        <div class="p-5 border-t border-gray-200">
                            <h4 class="font-semibold text-gray-600 mb-2">Considerations:</h4>
                            <p class="text-gray-600 leading-relaxed">${item.considerations}</p>
                        </div>
                    </div>
                `;
                strategicContainer.appendChild(element);
            });

            // Accordion click logic for Strategic Questions
            strategicContainer.addEventListener('click', (e) => {
                const button = e.target.closest('.accordion-button');
                if (button) {
                    const content = button.nextElementSibling;
                    const icon = button.querySelector('svg');
                    content.classList.toggle('open');
                    icon.classList.toggle('rotate-180');
                }
            });

            // --- 2. Load Decision Points ---
            const categoryList = document.getElementById('category-list');
            const pointsContainer = document.getElementById('decision-points-container');

            // Function to load points for a category
            function loadDecisionPoints(categoryId) {
                currentCategoryId = categoryId; // Update current category ID
                // Find category data
                const category = decisionPointsData.find(c => c.id === categoryId);
                if (!category) return;

                pointsContainer.innerHTML = ''; // Clear existing points

                // Populate points
                category.points.forEach(point => {
                    const noteKey = `note-${point.id}`;
                    const savedNote = localStorage.getItem(noteKey) || '';

                    // UPDATED to be an accordion
                    const pointCard = document.createElement('div');
                    pointCard.className = 'bg-white rounded-lg shadow-md overflow-hidden'; // Changed classes
                    pointCard.innerHTML = `
                        <button class="accordion-button w-full text-left p-5 font-semibold text-gray-700 flex justify-between items-center transition hover:bg-gray-50 rounded-lg">
                            <span class="text-lg">${point.decision_point}</span>
                            <svg class="w-5 h-5 transition-transform transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <div class="accordion-content">
                            <div class="p-5 border-t border-gray-200 space-y-4">
                                <div>
                                    <h4 class="font-semibold text-sm text-blue-600 mb-1">Summary of Existing Literature</h4>
                                    <p class="text-gray-600 text-sm leading-relaxed">${point.summary}</p>
                                </div>
                                <div>
                                    <h4 class="font-semibold text-sm text-gray-700 mb-2">Your Notes</h4>
                                    <textarea
                                        id="${noteKey}"
                                        class="note-textarea w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                        rows="4"
                                        placeholder="Enter your notes here... (Saved to your browser)"
                                    >${savedNote}</textarea>
                                </div>
                            </div>
                        </div>
                    `;
                    pointsContainer.appendChild(pointCard);
                });
            }

            // ADDED: Accordion click logic for Decision Points
            pointsContainer.addEventListener('click', (e) => {
                const button = e.target.closest('.accordion-button');
                if (button) {
                    const content = button.nextElementSibling;
                    const icon = button.querySelector('svg');
                    content.classList.toggle('open');
                    icon.classList.toggle('rotate-180');
                }
            });

            // Add debounced save listener to notes container
            let saveTimeout;
            pointsContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('note-textarea')) {
                    clearTimeout(saveTimeout);
                    saveTimeout = setTimeout(() => {
                        localStorage.setItem(e.target.id, e.target.value);
                    }, 300); // Save 300ms after user stops typing
                }
            });


            // Populate category list
            decisionPointsData.forEach((category, index) => {
                const button = document.createElement('button');
                button.className = 'category-button w-full text-left p-3 rounded-md font-medium text-gray-600 hover:bg-gray-200 transition';
                button.textContent = category.category;
                button.dataset.target = category.id;

                if (index === 0) {
                    button.classList.add('active'); // Set first as active
                }

                button.addEventListener('click', () => {
                    // Update active button
                    document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    // Load points
                    loadDecisionPoints(category.id);
                });

                categoryList.appendChild(button);
            });

            // --- 3. Attach Export Event Listeners ---
            document.getElementById('export-tsv').addEventListener('click', exportTSV);
            document.getElementById('export-pdf').addEventListener('click', exportPDF);

            // --- 4. Attach Modal Event Listeners ---
            clearNotesBtn.addEventListener('click', () => {
                clearModal.classList.add('visible');
            });

            cancelClearBtn.addEventListener('click', () => {
                clearModal.classList.remove('visible');
            });

            confirmClearBtn.addEventListener('click', () => {
                clearAllNotes();
                clearModal.classList.remove('visible');
                // Reload the current category view to show the cleared textareas
                loadDecisionPoints(currentCategoryId);
            });


            // --- 5. Initial Load ---
            loadDecisionPoints(currentCategoryId); // Load first category by default
        });
    </script>
</body>
</html>

